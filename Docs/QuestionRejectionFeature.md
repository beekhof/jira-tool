# Question Rejection Feature Specification

## Overview
Allow users to reject poor questions generated by Gemini during the Q&A flow, causing the system to skip the current question, generate a new one, and continue the flow.

## Requirements

### User Interaction
- Users can reject a question by entering:
  - `"reject"` (case-insensitive)
  - Empty string (just pressing Enter)
- When a question is rejected:
  - Show feedback message: "Question rejected, generating a new one..."
  - Skip the current question (don't add answer to history)
  - Add the rejected question to history as: "Q: [question] - REJECTED"
  - Generate a new question and continue the Q&A loop
  - Do NOT count the rejected question toward the maxQuestions limit

### Existing Behavior Preserved
- `"skip"` and `"done"` continue to end the Q&A loop early (existing behavior)
- Normal answers continue to work as before

### Context Handling
- Rejected questions are added to history as: "Q: [question] - REJECTED"
- No answer is recorded for rejected questions
- The rejection context is included when generating the next question, allowing Gemini to learn from what was rejected

## Q&A Summary

**Q1:** When a user marks a question as "poor", what should happen?
**A:** Skip the current question, generate a new one, and continue the Q&A flow.

**Q2:** How should the user indicate a question is poor?
**A:** Special keyword/command (e.g., type "poor", "bad", "skip-question", or "reject").

**Q3:** Which keywords/commands should trigger skipping a poor question?
**A:** "reject" or an empty string.

**Q4:** Should we keep "skip" and "done" to end the Q&A loop?
**A:** Yes, keep "skip" and "done" to end the Q&A loop (empty string and "reject" skip the question and continue).

**Q5:** Should there be any limit or feedback when a question is rejected?
**A:** Show a message like "Question rejected, generating a new one..." when a question is rejected, and we also need to include the rejection in the context when generating the next question.

**Q6:** How should the rejection be represented in the context for the next question?
**A:** Add "Q: [question] - REJECTED" to history (no answer recorded).

## Architecture

### Modified Components
- `pkg/qa/flow.go`: Update `RunQnAFlow` to handle rejection logic
  - Detect "reject" or empty string as rejection
  - Show feedback message
  - Add rejected question to history with "- REJECTED" suffix
  - Decrement loop counter to allow retry (or use separate counter)
  - Continue loop without adding answer

### Key Implementation Details
- Rejection detection: Check if answer is empty string or equals "reject" (case-insensitive)
- History management: Add "Q: [question] - REJECTED" instead of Q/A pair
- Loop control: Use a separate counter or decrement `i` to allow retry without counting toward maxQuestions
- Feedback: Print message before generating next question

## Error Handling
- If question generation fails after rejection, return the error (same as current behavior)
- If maxQuestions is reached after multiple rejections, proceed to description generation (same as current behavior)

## Testing Plan
1. **Test rejection with "reject" keyword**
   - Enter "reject" when prompted
   - Verify feedback message appears
   - Verify new question is generated
   - Verify rejected question appears in history as "Q: [question] - REJECTED"

2. **Test rejection with empty string**
   - Press Enter without typing anything
   - Verify feedback message appears
   - Verify new question is generated
   - Verify rejected question appears in history

3. **Test multiple rejections**
   - Reject multiple questions in a row
   - Verify each rejection generates a new question
   - Verify all rejected questions are in history

4. **Test rejection doesn't count toward maxQuestions**
   - Set maxQuestions to 2
   - Reject first question, answer second
   - Verify description is generated (not cut off early)

5. **Test "skip" and "done" still work**
   - Enter "skip" or "done"
   - Verify Q&A loop ends early (existing behavior)

6. **Test normal answers still work**
   - Answer questions normally
   - Verify behavior unchanged

7. **Test rejection context in next question**
   - Reject a question
   - Verify next question is different (not same question repeated)
   - Verify rejected question context is available to Gemini

## Edge Cases
- User rejects all questions up to maxQuestions → proceed to description generation with only rejected questions in history
- User rejects, then answers normally → verify both rejection and answer are in history correctly
- User rejects last question → proceed to description generation


